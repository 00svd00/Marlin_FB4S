# Marlin 3D Printer Firmware for Flying Bear 4S

## Версия с тестовой поддержкой WIFI модуля

Эта ветка содержит код для работы с WIFI модулем, установленным в FB4S. Загрузка файлов через стандартный plugin в Cura.
Ветка основана на ветке FB4S_Config, с добавлением кода работы с WIFI модулем.

## Что работает, что не работает

### Работает (иногда)

* Отображение температуры в Cura
* Просмотр содержимого SD карты
* Автоматический запуск печати при загрузке файла.
* Удаление файлов с SD карты
* Загрузка файлов на SD карту
* Настройка WIFI модуля (сеть и пароль)

### Не работает (совсем)

* **Имена файлов на русском** Переименуйте файл в Cura
* Отображение состояния принтера (печатает, не печатает) в Cura
* Все остальное, что не в указано в "работает"

## Как собрать прошивку самому



## Как работает, как настроить

### Если нет желания самому собирать прошивку

Готовые файлы лежат в папке firmware.

Если вы используете драйвера 2208, или аналогичные, прошивка в папке 2208 [Robin_nano35.bin](./firmware/2208/Robin_nano35.bin)

Если вы используете стандартные драйвера, прошивка в папке std [Robin_nano35.bin](./firmware/std/Robin_nano35.bin)

Отличия сборок только в инвертировании осей.

### Настройки WIFI, если вы используете готовую прошивку

Если модуль уже был настроен, то возможно никакая настройка не понадобится. Если модуль не был настроен, либо по какой-то причине не смог подключиться к сети, то он запустится в режиме точки доступа с именем сети MKSWIFI??? (вместо ? будут произвольные символы). Подключитесь к этой сети, откройте страницу по адресу 192.168.4.1 и установите нужные настройки.

### Настройки WIFI, если вы собираете прошивку сами

В файле [mks_wifi_settings.h](./Marlin/src/module/mks_wifi/mks_wifi_settings.h)

Для того, чтобы эти настройки применялись при включении, "MKS_WIFI_ENABLED_WIFI_CONFIG" должен быть раскоментирован. Если закоментировать "#define MKS_WIFI_ENABLED_WIFI_CONFIG" при запуске настройки ESP модулю отправляться не будут

### Диагностика WIFI

При успешном подключении к сети (или создании сети в режиме точки доступа) в стандартный UART, который выведен на USB разъем принтера, будет выведен IP адрес и название сети. Если у модуля ESP есть какие-то настройки сети, но подключиться к ней он не смог, то модуль перейдет в режим точки доступа, и выдаст в UART название точки доступа и свой IP. На попытки подключения к сети уходит несколько минут.

IP адрес так же будет на экране.

### Как понять, что оно работает

При включении принтера, на экране отобразится статус "WIFI init"

Если ESP модулю удалось подключиться к сети, на экране будет IP адрес.

При старте передачи файла отображается "Upload file", в процессе загрузки отображается прогресс в процентах.

Если файл успешно принят отобразится "Upload done" и **прозвучит звуковой сигнал**

Если во время приема файла были ошибки, отобразится надпись "Upload Failed" и **звукового сигнала не будет**
